<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>NewAbstractEditCollectionHandler.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">widgets</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vetorizar</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handler</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Sprite</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MouseEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TimerEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Timer</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">collections</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ArrayCollection</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">controls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Alert</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Map</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FeatureEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LayerEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MapEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">feature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Feature</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">feature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">PointFeature</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">feature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">State</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">feature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FeatureClickHandler</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">handler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">feature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">draw</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AbstractEditHandler</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">VectorLayer</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">style</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Style</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Geometry</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ICollection</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Point</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">basetypes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Location</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">org</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">openscales</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">basetypes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Pixel</span>;
    
    
    <span class="ActionScriptASDoc">/** 
     * @eventType org.openscales.core.events.LayerEvent.LAYER_EDITION_MODE_START
     */</span> 
    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"openscales.layerEditionModeStart"</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"org.openscales.core.events.LayerEvent"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>
    
    <span class="ActionScriptASDoc">/**
     * This class is a handler used for Collection(Linestring Polygon MultiPolygon etc..) modification
     * don't use it use EditPathHandler if you want to edit a LineString or a MultiLineString
     * or EditPolygon 
     * */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">AbstractEditHandler</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptASDoc">/**
         * index of the feature currently drag in the geometry collection
         * 
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">indexOfFeatureCurrentlyDrag</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>-1;
        
        <span class="ActionScriptASDoc">/**
         * This singleton represents the point under the mouse during the dragging operation
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_pointUnderTheMouse</span>:<span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
        
        <span class="ActionScriptASDoc">/**
         * The point that is created under the mouse in edition mode.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_dummyPointOnTheMouse</span>:<span class="ActionScriptDefault_Text">Feature</span>;
        <span class="ActionScriptASDoc">/**
         * This tolerance is used to manage the point on the segments
         * */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_detectionTolerance</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>2;
        <span class="ActionScriptASDoc">/**
         * This tolerance is used to discern Virtual vertices from point under the mouse
         * */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ToleranceVirtualReal</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>10;
        <span class="ActionScriptASDoc">/**
         * We use a timer to manage the mouse out of a feature
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_timer</span>:<span class="ActionScriptDefault_Text">Timer</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Timer</span><span class="ActionScriptBracket/Brace">(</span>500<span class="ActionScriptOperator">,</span>1<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptASDoc">/**
         * To know if we displayed the virtual vertices of collection feature or not
         **/</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_displayedVirtualVertices</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
                
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpfeature</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        
        
        <span class="ActionScriptASDoc">/**
         * This class is a handler used for Collection(Linestring Polygon MultiPolygon etc..) modification
         * don't use it use EditPathHandler if you want to edit a LineString or a MultiLineString
         * or EditPolygon 
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">map</span>:<span class="ActionScriptDefault_Text">Map</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">active</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">layerToEdit</span>:<span class="ActionScriptDefault_Text">VectorLayer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">featureClickHandler</span>:<span class="ActionScriptDefault_Text">FeatureClickHandler</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">drawContainer</span>:<span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">isUsedAlone</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">active</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">layerToEdit</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">featureClickHandler</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">drawContainer</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">isUsedAlone</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">featureClickHandler</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">featureClickHandler</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_timer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">TimerEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TIMER</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">deletepointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * This function is used for Polygons edition mode starting
         * 
         * */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">editionModeStart</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vectorFeature</span>:<span class="ActionScriptDefault_Text">Feature</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">features</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>    
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorFeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isEditable</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">vectorFeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>            
                    <span class="ActionScriptComment">//Clone or not
</span>                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">displayedVirtualVertices</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptDefault_Text">displayVisibleVirtualVertice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorFeature</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_isUsedAlone</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">LayerEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">LayerEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LAYER_EDITION_MODE_START</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;    
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FeatureEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FEATURE_MOUSEMOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">createPointUndertheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>        
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc 
         * */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">editionModeStop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//if the handler is used alone we remove the listener
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_isUsedAlone</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FeatureEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FEATURE_MOUSEMOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">createPointUndertheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_timer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">TimerEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TIMER</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">deletepointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;    
            
            <span class="ActionScriptDefault_Text">removeVisibleVirtualVertice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">editionModeStop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span> 
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc 
         * */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dragVerticeStart</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span>:<span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentFeature</span>:<span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">findVirtualVerticeParent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentFeature</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">parentFeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//We start to drag the vector feature
</span>                    <span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">startDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptComment">//We see if the feature already belongs to the edited vector feature
</span>                    <span class="ActionScriptDefault_Text">indexOfFeatureCurrentlyDrag</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">findIndexOfFeatureCurrentlyDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureCurrentlyDrag</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">vectorfeature</span>;
                    <span class="ActionScriptReserved">else</span>
                        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureCurrentlyDrag</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
                    
                    <span class="ActionScriptComment">//we add the new mouseEvent move and remove the previous
</span>                    <span class="ActionScriptDefault_Text">_timer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">panNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">zoomNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">keyboardNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_MOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">drawTemporaryFeature</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_isUsedAlone</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FeatureEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FEATURE_MOUSEMOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">createPointUndertheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">displayVisibleVirtualVertice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureEdited</span>:<span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//super.displayVisibleVirtualVertice(featureEdited);
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureEdited</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//We only draw the points included in the map extent
</span>                <span class="ActionScriptDefault_Text">tmpfeature</span> <span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;    
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">feature</span>:<span class="ActionScriptDefault_Text">Feature</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1;
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span>;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptOperator">-</span>1;<span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">feature</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">featureParent</span>:<span class="ActionScriptDefault_Text">Feature</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">findVirtualVerticeParent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">feature</span>  <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptComment">//we also clean the virtual vertices array if the parent doesnt belongs anymore to the _layerToEdit.features array
</span>                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureParent</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">featureEdited</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">features</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureParent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">==</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">feature</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureClickHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeControledFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">feature</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">tmpfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptComment">//feature to delete
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">!=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//for each(feature in tmpfeature){
</span>                    <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmpfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span>:<span class="ActionScriptDefault_Text">int</span>;
                    <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span>;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptOperator">-</span>1;<span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpfeature</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">,</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">tmpfeature</span><span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">super</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">createEditionVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureEdited</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">featureEdited</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">tmpfeature</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span>;
                <span class="ActionScriptReserved">for each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">tmpfeature</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureClickHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addControledFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">feature</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">v</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">feature</span>;
                    <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">featureEdited</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptComment">//for garbage collector
</span>                <span class="ActionScriptComment">//tmpfeature=null;    
</span>            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeVisibleVirtualVertice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">feature</span>:<span class="ActionScriptDefault_Text">Feature</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpfeature</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">tmpfeature</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureClickHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeControledFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_editionFeatureArray</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">&gt;</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptDefault_Text">tmpfeature</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc 
         * */</span>
        <span class="ActionScriptReserved">override</span>  <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dragVerticeStop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span>:<span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//We stop the drag 
</span>                <span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stopDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptComment">//var parentGeometry:Collection=vectorfeature.editionFeatureParentGeometry as Collection;
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentFeature</span>:<span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">findVirtualVerticeParent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentFeature</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">parentFeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentGeometry</span>:<span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">editionFeatureParentGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">parentFeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">componentLength</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentsLength</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureClickHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeControledFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lonlat</span>:<span class="ActionScriptDefault_Text">Location</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getLocationFromMapPx</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Pixel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseX</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseY</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//this.map.getLocationFromLayerPx(new Pixel(this._layerToEdit.mouseX,this._layerToEdit.mouseY));            
</span>                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newVertice</span>:<span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lonlat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lon</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lonlat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lat</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptComment">//if it's a real vertice of the feature
</span>                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">replaceComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indexOfFeatureCurrentlyDrag</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">newVertice</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">else</span>
                            <span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newVertice</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">indexOfFeatureCurrentlyDrag</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">displayedVirtualVertices</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">displayVisibleVirtualVertice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">findVirtualVerticeParent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;     
                    <span class="ActionScriptBracket/Brace">}</span>     
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">//we add the new mouseEvent move and remove the MouseEvent on the draw Temporary feature
</span>            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;    
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_isUsedAlone</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FeatureEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FEATURE_MOUSEMOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">createPointUndertheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_MOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">drawTemporaryFeature</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">panNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">zoomNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">keyboardNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureCurrentlyDrag</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
            
            <span class="ActionScriptComment">//We remove the point under the mouse if it was dragged
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureClickHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeControledFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_drawContainer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clear</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptDefault_Text">_timer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">//vectorfeature.editionFeatureParent.draw();
</span>            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">redraw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc 
         * */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">featureClick</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">FeatureEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vectorfeature</span>:<span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">feature</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">PointFeature</span>;

            <span class="ActionScriptComment">//We remove listeners and tempoorary point
</span>            <span class="ActionScriptComment">//This is a bug we redraw the layer with new vertices for the impacted feature
</span>            <span class="ActionScriptComment">//The click is considered as a bug for the moment         
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">displayedVirtualVertices</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">displayVisibleVirtualVertice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">findVirtualVerticeParent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureClickHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeControledFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">vectorfeature</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_isUsedAlone</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FeatureEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FEATURE_MOUSEMOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">createPointUndertheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_MOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">drawTemporaryFeature</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureCurrentlyDrag</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptComment">//we remove it
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_drawContainer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clear</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">_timer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">redraw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc 
         * */</span>
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">featureDoubleClick</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">FeatureEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vectorfeature</span>:<span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">feature</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">PointFeature</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentFeature</span>:<span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">findVirtualVerticeParent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentFeature</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">parentFeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentGeometry</span>:<span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">editionFeatureParentGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">parentFeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">IsRealVertice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>             
                    <span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentByIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptComment">//add
</span>                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentsLength</span> <span class="ActionScriptOperator">==</span> 1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeComponent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentByIndex</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentFeature</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">displayedVirtualVertices</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">displayVisibleVirtualVertice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">findVirtualVerticeParent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptComment">//we delete the point under the mouse 
</span>                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_isUsedAlone</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FeatureEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FEATURE_MOUSEMOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">createPointUndertheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MOUSE_MOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">drawTemporaryFeature</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureCurrentlyDrag</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_drawContainer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">clear</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_timer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">redraw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">panNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">zoomNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">keyboardNavigationEnabled</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * This function is used to manage the mouse when the mouse is out of the feature
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onFeatureOut</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evt</span>:<span class="ActionScriptDefault_Text">FeatureEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>         
            <span class="ActionScriptDefault_Text">_timer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">start</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">deletepointUnderTheMouse</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evt</span>:<span class="ActionScriptDefault_Text">TimerEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//we hide the point under the mouse
</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">_timer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">filterCallbackOnPointUnderTheMouse</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">index</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">vector</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_dummyPointOnTheMouse</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * Create a virtual vertice under the mouse 
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createPointUndertheMouse</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evt</span>:<span class="ActionScriptDefault_Text">FeatureEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vectorfeature</span>:<span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">evt</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">feature</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Feature</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layer</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_timer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">stop</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">buttonMode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>; 
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">px</span>:<span class="ActionScriptDefault_Text">Pixel</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Pixel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseX</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">mouseY</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">//drawing equals false if the mouse is too close from Virtual vertice
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">drawing</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_dummyPointOnTheMouse</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_editionFeatureArray</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">filter</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">filterCallbackOnPointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">feature</span>:<span class="ActionScriptDefault_Text">Feature</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Feature</span>;
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">feature</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">feature</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span>  <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpPx</span>:<span class="ActionScriptDefault_Text">Pixel</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getMapPxFromLocation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Location</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">feature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">,</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">feature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpPx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">px</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_ToleranceVirtualReal</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpPx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">px</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_ToleranceVirtualReal</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">drawing</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                            <span class="ActionScriptReserved">break</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">drawing</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmpPoints</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span>;
                    
                    <span class="ActionScriptDefault_Text">layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">buttonMode</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                    
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lonlat</span>:<span class="ActionScriptDefault_Text">Location</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getLocationFromMapPx</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">px</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">lonlat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">reprojectTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">projection</span><span class="ActionScriptBracket/Brace">)</span>;<span class="ActionScriptComment">//this.map.getLocationFromLayerPx(px);
</span>                    
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PointGeomUnderTheMouse</span>:<span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lonlat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lon</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">lonlat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lat</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">PointGeomUnderTheMouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">projection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lonlat</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">projection</span>;
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                        <span class="ActionScriptDefault_Text">tmpPoints</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                                                
                        <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">PointGeomUnderTheMouse</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">virtualStyle</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureClickHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addControledFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">PointGeomUnderTheMouse</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">virtualStyle</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureClickHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addControledFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layer</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> 
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpPoints</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeatures</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tmpPoints</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Feature</span><span class="ActionScriptBracket/Brace">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span>;
                        <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vectorfeature</span>;
                        
                        <span class="ActionScriptDefault_Text">_editionFeatureArray</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_dummyPointOnTheMouse</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">findIndexOfFeatureCurrentlyDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span> 
                        <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                    <span class="ActionScriptBracket/Brace">}</span> 
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptDefault_Text">layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">redraw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">buttonMode</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                        <span class="ActionScriptDefault_Text">layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">redraw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">buttonMode</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;        
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * To draw the temporaries feature during drag Operation
         * */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">drawTemporaryFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">override</span> <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">refreshEditedfeatures</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MapEvent</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_featureClickHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeControledFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">_layerToEdit</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">redraw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * To find the index of feature currently dragged in it's geometry parent array
         * @param vectorfeature:PointFeature the dragged feature
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">findIndexOfFeatureCurrentlyDrag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span>:<span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentFeature</span>:<span class="ActionScriptDefault_Text">Feature</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">findVirtualVerticeParent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentFeature</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">parentFeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">parentFeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">parentgeometry</span>:<span class="ActionScriptDefault_Text">ICollection</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">editionFeatureParentGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentFeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">NewAbstractEditCollectionHandler</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_pointUnderTheMouse</span><span class="ActionScriptBracket/Brace">)</span> 
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getSegmentsIntersection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentgeometry</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">IsRealVertice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">parentgeometry</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * To know if a dragged point is a under the mouse or is a vertice
         * if it's a point returns its index else returns -1
         * @private
         * */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">IsRealVertice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span>:<span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">parentgeometry</span>:<span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentgeometry</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>0;        
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">geom</span>:<span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Point</span>;
                <span class="ActionScriptComment">//for each components of the geometry we see if the point belong to it
</span>                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">parentgeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentsLength</span>;<span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>        
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">editionfeaturegeom</span>:<span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">parentgeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentByIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Point</span>;
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">editionfeaturegeom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vectorfeature</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">editionfeaturegeom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">parentgeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentsLength</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">index</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * This function find a parent Geometry of an edition feature
         * @param point
         * TODO: really needs to be rewrited
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">editionFeatureParentGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">point</span>:<span class="ActionScriptDefault_Text">PointFeature</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">parentGeometry</span>:<span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ICollection</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">point</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">int</span>;
                    
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentsLength</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span> 
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentByIndex</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentsLength</span>;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">equals</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentByIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                                <span class="ActionScriptBracket/Brace">{</span>
                                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">parentGeometry</span>;
                                <span class="ActionScriptBracket/Brace">}</span>    
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">else</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentsLength</span>;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">geomParent</span>:<span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">editionFeatureParentGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">parentGeometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">componentByIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ICollection</span><span class="ActionScriptBracket/Brace">)</span>;
                                
                                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geomParent</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                                <span class="ActionScriptBracket/Brace">{</span>
                                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">geomParent</span>;
                                <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span> 
                        
                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">parentGeometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ICollection</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//getters &amp;&amp; setters
</span>        <span class="ActionScriptASDoc">/**
         * Tolerance used for detecting  point
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">detectionTolerance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_detectionTolerance</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">detectionTolerance</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>         
            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_detectionTolerance</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">value</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * To know if we displayed the virtual vertices of collection feature or not
         **/</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">displayedVirtualVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_displayedVirtualVertices</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/**
         * @private
         * */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">displayedVirtualVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_displayedVirtualVertices</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_displayedVirtualVertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">value</span>;
                
                <span class="ActionScriptDefault_Text">refreshEditedfeatures</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
